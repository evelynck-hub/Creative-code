let img1;
let img2;
let spaceship;
let fire1;
let fire2;
let showImg1 = true;
let interval = 500;
let previousTime;
let bg;
let serial;
let latestData = 0;
let img3;
let x = 50;
let y = 380;
let xPos;

function preload() {
  img1 = loadImage("breath 1.png");
  img2 = loadImage("breath 2.png");
  bg = loadImage("Bg.jpg");
  spaceship = loadImage("spaceship1.png");
  fire1 = loadImage("fire1.png");
  fire2 = loadImage("fire2.png"); // preload fire2 as well
  img3 = loadImage("slime2.png");
}

function setup() {
  createCanvas(1000, 720);
  previousTime = millis();
  //x = constrain(x, 0, width);

  serial = new p5.SerialPort();
  serial.list();
  serial.openPort("COM5");
  let serialPorts = ["", "COM5"];
  let serials = [];
  let data = [];
  serial.on("connected", serverConnected);
  // callback to print the list of serial devices
  serial.on("list", gotList);
  // what to do when we get serial data
  serial.on("data", gotData);
  // what to do when there's an error
  serial.on("error", gotError);
  // when to do when the serial port opens
  serial.on("open", gotOpen);
  // what to do when the port closes
  serial.on("close", gotClose);
  function serverConnected() {
    console.log("Connected to Server");
  }
  function gotList(thelist) {
    console.log("List of Serial Ports:");

    for (let i = 0; i < thelist.length; i++) {
      console.log(i + " " + thelist[i]);
    }
  }

  function gotOpen() {
    console.log("Serial Port is Open");
  }

  function gotClose() {
    console.log("Serial Port is Closed");
    latestData = "Serial Port is Closed";
  }

  function gotError(theerror) {
    console.log(theerror);
  }

  // when data is received in the serial buffer

  function gotData() {
    let currentString = serial.readLine(); // store the data in a variable
    currentString = trim(currentString); // get rid of whitespace
    if (!currentString) return; // if there's nothing in there, ignore it
    console.log(currentString); // print it out

    latestData = float(currentString);
  }
}

function draw() {
  background(bg);
  //imageMode(CENTER);
  // Draw slime
  image(img3, x, y);

  //imageMode(CENTER);

  // Display incoming serial value
  //text(latestData, 10, 10);

  if (latestData < -0.5) {
    x -= 3;
  } else if (latestData > 0.5) {
    x += 3;
    // keep sprite inside screen
    x = constrain(x, 0, width);
  }

  let currentTime = millis();

  // Alternate the image every interval
  if (currentTime - previousTime > interval) {
    showImg1 = !showImg1;
    previousTime = currentTime;
  }

  // Set a fixed smaller size for both breath images
  let scaleFactor = 0.5; // 50% of original size
  let imgWidth, imgHeight;

  if (showImg1) {
    // Show breath1 and fire1
    imgWidth = img1.width * scaleFactor;
    imgHeight = img1.height * scaleFactor;
    image(img1, 810 - imgWidth / 2, 290, imgWidth, imgHeight);

    let fireWidth = fire1.width * scaleFactor;
    let fireHeight = fire1.height * scaleFactor;
    image(fire1, 90 - fireWidth / 2, 217, fireWidth, fireHeight); // adjust y position as needed
  } else {
    // Show breath2 and fire2
    imgWidth = img2.width * scaleFactor;
    imgHeight = img2.height * scaleFactor;
    image(img2, 810 - imgWidth / 2, 290, imgWidth, imgHeight);

    let fireWidth = fire2.width * scaleFactor;
    let fireHeight = fire2.height * scaleFactor;
    image(fire2, 90 - fireWidth / 2, 217, fireWidth, fireHeight); // adjust y position as needed
  }
}
